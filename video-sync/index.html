<!DOCTYPE html>
<html>

<head>
  <title>Screenplay Video Sync</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      cursor: none;
    }
  </style>
</head>

<body>
  <video id="video" muted src="/boot/screenplay.mp4"
    style="width: 100%; height: 100%; object-fit: fill;"></video>
  <script>
    const video = document.getElementById('video');

    // Add an event listener for the 'canplaythrough' event
    video.addEventListener('canplaythrough', () => {
      // Parse the URL to get the hash value
      const hash = window.location.hash;
      // Remove the leading '#' character from the hash
      const ip = hash.slice(1);
      // Set the WebSocket URL based on the hash value
      const wsUrl = ip ? `ws://${ip}:8080` : 'ws://localhost:8080';

      const ws = new WebSocket(wsUrl);

      ws.onmessage = (event) => {
        if (event.data === 'play') {
          video.play();
        } else if (event.data === 'restart') {
          video.currentTime = 0;
          video.play();
        }
      };

      ws.onopen = () => { ws.send('start'); };

      video.addEventListener('ended', () => {
        ws.send('restart');
      });
    });
  </script>
</body>

</html>